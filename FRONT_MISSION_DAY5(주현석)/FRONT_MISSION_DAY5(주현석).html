<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .completed {
            color: blue;
        }

        .failed {
            color: red;
        }
    </style>
</head>

<body>
    <h1>Todo List</h1>
    <p>https://jsonplaceholder.typicode.com/todos 의 데이터를 기반으로 구현</p>
    <p>입력 폼을 이용하여 userid 기반으로 todo 데이터를 조회하여 출력한다.</p>
    <input type="text" id="select"> <button id="selectBtn">USERID를 이용한 TODO 조회</button><br>
    <input type="text" id="search"><button id="searchBtn">재목을 이용한 검색</button><br>
    <div id="todos"></div>
    <input type="checkbox" id="completeChk">완료됨 <input type="checkbox" id="styleChk">완료/미완 구분
</body>
<script>
    const todos = document.querySelector("#todos");
    const selectBtn = document.querySelector("#selectBtn");
    const searchBtn = document.querySelector("#searchBtn");
    const completeChk = document.querySelector("#completeChk");
    const styleChk = document.querySelector("#styleChk");

    let todoData = [];

    async function searchTodosWithUserId(userId) {
        todos.innerHTML = "";
        todoData = [];

        try {
            const response = await fetch("https://jsonplaceholder.typicode.com/todos");
            if (!response.ok) throw new Error("서버 에러 발생");
            const data = await response.json();

            data.forEach(item => {
                if (item.userId == userId) {
                    todos.innerHTML += `<h3>${item.title}, ${item.completed}</h3>`;
                    todoData.push(item);
                }
            });
        } catch (error) {
            console.error(error);
        }
    }

    async function searchTodoWithTitle(title) {
        todos.innerHTML = "";
        todoData = [];

        try {
            const response = await fetch("https://jsonplaceholder.typicode.com/todos");
            if (!response.ok) throw new Error("서버 오류 발생!");
            const data = await response.json();

            data.forEach(item => {
                if (item.title.includes(title)) {
                    todos.innerHTML += `<h3>${item.title}, ${item.completed}</h3>`;
                    todoData.push(item);
                }
            });
        } catch (error) {
            console.error(error);
        }
    }

    selectBtn.addEventListener("click", () => {
        const userId = document.querySelector("#select").value;
        searchTodosWithUserId(userId);
    });

    searchBtn.addEventListener("click", () => {
        const search = document.querySelector("#search").value
        searchTodoWithTitle(search);
    });

    completeChk.addEventListener("click", () => {
        todos.innerHTML = "";

        if (completeChk.checked) {
            todoData.forEach(item => {
                if (item.completed) {
                    todos.innerHTML += `<h3>${item.title}, ${item.completed}</h3>`;
                }
            });
        } else {
            todoData.forEach(item => {
                todos.innerHTML += `<h3>${item.title}, ${item.completed}</h3>`;
            });
        }
    });

    styleChk.addEventListener("click", () => {
        todos.innerHTML = "";

        if (styleChk.checked) {
            todoData.forEach(item => {
                todos.innerHTML += `<h3 class="${item.completed ? 'completed' : 'failed'}">${item.title}, ${item.completed}</h3>`;
            });
        } else {
            todoData.forEach(item => {
                todos.innerHTML += `<h3>${item.title}, ${item.completed}</h3>`;
            });
        }
    });



</script>

</html>